"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _model=_interopRequireDefault(require("./model")),_utils=_interopRequireDefault(require("./utils")),_logger=_interopRequireDefault(require("./logger"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var r=[],i=!0,n=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(i=(a=l.next()).done)&&(r.push(a.value),!t||r.length!==t);i=!0);}catch(e){n=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(n)throw o}}return r}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=_superPropBase(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var DevsAtomic=function(e){function u(e){var t;return _classCallCheck(this,u),(t=_possibleConstructorReturn(this,_getPrototypeOf(u).call(this,e))).__simulator__=null,t}return _inherits(u,_model.default),_createClass(u,[{key:"registerState",value:function(e){if(_utils.default.common.isObject(e)&&_utils.default.common.isString(e.name)){var t=_utils.default.common.trimString(e.name);if(0!==t.length){var r=e.value;if(_utils.default.common.isNull(r))r=_utils.default.common.hashString(t);else if(!_utils.default.common.isNumber(r))return void _logger.default.error("DevsAtomic::registerState failed - option.handle is not number");this.__stateHandles__.has(r)?_logger.default.warn("DevsAtomic::registerState failed - option.handle is added : ".concat(e)):this.__stateHandles__.set(r,t)}else _logger.default.error("DevsAtomic::registerState failed - option.name is invalid")}else _logger.default.error("DevsAtomic::registerState failed - invalid param")}},{key:"ta",value:function(){return this.__sigma__}},{key:"phase",value:function(){return this.__phase__}},{key:"sigma",value:function(e){if(!e)return this.__sigma__;_utils.default.common.isNumber(e)?this.__sigma__=e:_logger.default.error("DevsAtomic::sigma failed - delta <".concat(e,"> is not number"))}},{key:"simulator",value:function(e){if(!e)return this.__simulator__;_utils.default.common.isObject(e)?this.__simulator__=e:_logger.default.error("DevsAtomic::simulator failed - invalid param : ".concat(e))}},{key:"initialize",value:function(){}},{key:"deltext",value:function(e,t){}},{key:"deltint",value:function(){}},{key:"output",value:function(){return null}},{key:"deltcon",value:function(e,t){this.deltint(),this.deltext(0,t)}},{key:"resume",value:function(e){if(this.__sigma__<_utils.default.devs.time.Infinity){var t=this.__sigma__-e;t<0&&_logger.default.warn("DevsAtomic::resume - sigma < 0"),this.sigma(t)}}},{key:"holdIn",value:function(e,t){if(!_utils.default.common.isString(e)&&!_utils.default.common.isNumber(e))return _logger.default.error("DevsAtomic::holdIn failed - state is invalid : ".concat(e)),!1;var r=e;_utils.default.common.isString(r)&&(r=this.phaseHandle(r)),_utils.default.common.isNull(r)?_logger.default.error("DevsAtomic::holdIn failed - state <".concat(e,"> can not found")):(this.__phase__=r,this.sigma(t))}},{key:"passivateIn",value:function(e){this.holdIn(e,_utils.default.devs.time.Infinity)}},{key:"phaseIs",value:function(e){if(!_utils.default.common.isString(e)&&!_utils.default.common.isNumber(e))return _logger.default.error("DevsAtomic::phaseIs failed - state is invalid : ".concat(e)),!1;var t=e;return _utils.default.common.isString(t)&&(t=this.phaseHandle(t)),!!_utils.default.common.isNumber(t)&&this.__phase__===t}},{key:"phaseName",value:function(e){return _utils.default.common.isNumber(e)?this.__portHandles__.has(e)?null:this.__portHandles__.get(e):(_logger.default.error("DevsAtomic::phaseName failed - handle is invalid : ".concat(e)),null)}},{key:"phaseHandle",value:function(e){if(!_utils.default.common.isString(e))return _logger.default.error("DevsAtomic::phaseHandle failed - name is invalid : ".concat(e)),null;var t=null,r=!0,i=!1,n=void 0;try{for(var o,a=this.__stateHandles__.entries()[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var l=_slicedToArray(o.value,2),s=l[0];if(l[1]===e){t=s;break}}}catch(e){i=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw n}}return t}},{key:"toJson",value:function(){var e=new Array,t=!0,r=!1,i=void 0;try{for(var n,o=this.__stateHandles__.entries()[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var a=_slicedToArray(n.value,2),l=a[0],s=a[1];0!==l&&e.push({name:s,value:l})}}catch(e){r=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw i}}return Object.assign(_get(_getPrototypeOf(u.prototype),"toJson",this).call(this),{states:e})}},{key:"fromJson",value:function(e){_get(_getPrototypeOf(u.prototype),"fromJson",this).call(this,e),this.__sigma__=0,this.__phase__=0,this.__stateHandles__?this.__stateHandles__.clear():this.__stateHandles__=new Map;var t="Passive";if(this.registerState({name:t,value:_utils.default.devs.state[t]}),_utils.default.common.isArray(e.states)){var r=!0,i=!1,n=void 0;try{for(var o,a=e.states[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var l=o.value;if(_utils.default.common.isString(l))this.registerState({name:l});else if(_utils.default.common.isObject(l)){if(0===l.handle){_logger.default.error("DevsAtomic::constructor failed - handle of state <".concat(l.name,"> is 0"));continue}this.registerState(l)}else _logger.default.error("DevsAtomic::constructor failed - state is invalid : <".concat(l,">"))}}catch(e){i=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw n}}}}}]),u}(),_default=DevsAtomic;exports.default=_default;